<div class="d-flex align-items-center justify-content-center min-vh-100 p-4">
  <div class="w-100" style="max-width: 900px">
    <div class="card shadow-lg rounded-xl overflow-hidden">
      <div class="card-header-custom p-4 d-flex align-items-center gap-3 rounded-top-xl">
        <i class="fas fa-book-open text-4xl"></i>
        <div class="text-right">
          <h2 class="fs-2 fw-bold mb-1">تفاصيل الحلقة</h2>
          <p class="fs-5 opacity-90">عرض معلومات الحلقة</p>
        </div>
      </div>

      <div class="card-body p-5">
        <div class="mb-4">
          <p class="detail-label">اسم الحلقة</p>
          <h3 class="detail-value" id="halaqaNameDetail">{{halaqa.name}}</h3>
        </div>

        <div class="mb-4">
          <p class="detail-label">الوصف</p>
          <p class="detail-value" id="descriptionDetail">
            {{halaqa.description}}
          </p>
        </div>

        <div class="row g-4 mb-4">
          <div class="col-12 col-md-6">
            <p class="detail-label">نوع المجموعة</p>
            <p class="detail-value" id="genderGroupDetail">
              {{halaqa.genderGroup === 1 ? 'ذكور' : halaqa.genderGroup === 2 ?
              'إناث' : 'مختلطة'}}
            </p>
          </div>
          <div class="col-12 col-md-6">
            <p class="detail-label">المادة / الموضوع</p>
            <p class="detail-value" id="subjectDetail">
              {{halaqa.subjectName}}
            </p>
          </div>
        </div>

        <div class="mb-4">
          <p class="detail-label">حالة الحلقة</p>
          <p class="detail-value" id="halaqaStatusDetail">
            {{ halaqa.isDeleted ? 'غير متوفرة' : 'متوفرة' }}
          </p>
        </div>

        <div class="mt-5">
          <h4 class="mb-3 fw-bold">جدول الحصص</h4>
          @if(userRole == "Admin")
          {
          <button type="button" class="btn btn-success mb-3 py-2 px-4 shadow-sm d-flex align-items-center gap-2"
            data-bs-toggle="modal" data-bs-target="#addScheduleModal" style="background-color: #047857 !important">
            <i class="fas fa-plus-circle"></i>
            إضافة حصة جديدة
          </button>
          }

          <div class="table-responsive rounded-lg shadow-sm">
            <table class="table table-hover mb-0">
              <thead class="bg-light">
                <tr>
                  <th scope="col">اليوم</th>
                  <th scope="col">وقت البدء</th>
                  <th scope="col">وقت الانتهاء</th>
                  <th scope="col">الحالة</th>
                  @if(userRole == "Admin")
                  {
                  <th scope="col">إجراءات</th>
                  }
                </tr>
              </thead>
              <tbody id="scheduleTableBody">
                <tr *ngFor="let schedule of halaqa.classSchedules">
                  <td>{{ getDayName(schedule.day) }}</td>
                  <td>{{ schedule.startTime }}</td>
                  <td>{{ schedule.endTime }}</td>
                  <td>{{ schedule.isDeleted ? 'غير متوفرة' : 'متوفرة' }}</td>
                  @if(userRole == "Admin")
                  {
                  <td>
                    <button class="btn btn-sm btn-info text-white me-2" data-bs-toggle="modal"
                      data-bs-target="#updateScheduleModal" (click)="startEditSchedule(schedule)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger me-2" *ngIf="!schedule.isDeleted"
                      (click)="deleteSchedule(schedule.id)">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                    <button class="btn btn-sm btn-success" *ngIf="schedule.isDeleted"
                      (click)="restoreSchedule(schedule.id)">
                      <i class="fas fa-undo"></i> استعادة
                    </button>
                  </td>
                  }
                </tr>
                <tr *ngIf="halaqa.classSchedules?.length === 0">
                  <td colspan="4" class="text-center">
                    لا يوجد حصص مجدولة لهذه الحلقة.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>



        <div class="d-flex justify-content-start mt-4">
          <button type="button" class="btn btn-secondary py-3 px-5 shadow-sm d-flex align-items-center gap-2"
            onclick="history.back()" style="background-color: #9ca3af !important">
            <i class="fas fa-arrow-right"></i>
            العودة
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
@if(userRole == "Admin")
{
<div class="modal fade" id="addScheduleModal" tabindex="-1" aria-labelledby="addScheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-xl shadow-lg">
      <div class="modal-header modal-header-custom rounded-top-xl">
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        <h5 class="modal-title" id="addScheduleModalLabel">إضافة حصة جديدة</h5>
      </div>
      <div class="modal-body p-4">
        <form id="addScheduleForm" (ngSubmit)="addSchedule()">
          <div class="mb-3">
            <label for="scheduleDay" class="form-label">اليوم</label>
            <select id="scheduleDay" class="form-select" required [(ngModel)]="newSchedule.day" name="day">
              <option>اختر اليوم</option>
              <option value="0">الأحد</option>
              <option value="1">الاثنين</option>
              <option value="2">الثلاثاء</option>
              <option value="3">الأربعاء</option>
              <option value="4">الخميس</option>
              <option value="5">الجمعة</option>
              <option value="6">السبت</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="scheduleStartTime" class="form-label">وقت البدء</label>
            <input type="time" id="scheduleStartTime" class="form-control" required [(ngModel)]="newSchedule.startTime"
              name="startTime" />
          </div>
          <div class="mb-3">
            <label for="scheduleEndTime" class="form-label">وقت الانتهاء</label>
            <input type="time" id="scheduleEndTime" class="form-control" required [(ngModel)]="newSchedule.endTime"
              name="endTime" />
          </div>
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              إلغاء
            </button>
            <button type="submit" class="btn btn-success" style="background-color: #047857 !important">
              حفظ الحصة
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="updateScheduleModal" tabindex="-1" aria-labelledby="updateScheduleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-xl shadow-lg">
      <div class="modal-header modal-header-custom rounded-top-xl">
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        <h5 class="modal-title" id="updateScheduleModalLabel">تعديل الحصة</h5>
      </div>
      <div class="modal-body p-4">
        <form id="updateScheduleForm" (ngSubmit)="updateSchedule()">
          <div class="mb-3">
            <label for="updateScheduleDay" class="form-label">اليوم</label>
            <select id="updateScheduleDay" class="form-select" required [(ngModel)]="editSchedule.day" name="day">
              <option value="">اختر اليوم</option>
              <option value="0">الأحد</option>
              <option value="1">الاثنين</option>
              <option value="2">الثلاثاء</option>
              <option value="3">الأربعاء</option>
              <option value="4">الخميس</option>
              <option value="5">الجمعة</option>
              <option value="6">السبت</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="updateScheduleStartTime" class="form-label">وقت البدء</label>
            <input type="time" id="updateScheduleStartTime" class="form-control" required
              [(ngModel)]="editSchedule.startTime" name="editStartTime" />
          </div>
          <div class="mb-3">
            <label for="updateScheduleEndTime" class="form-label">وقت الانتهاء</label>
            <input type="time" id="updateScheduleEndTime" class="form-control" required
              [(ngModel)]="editSchedule.endTime" name="editEndTime" />
          </div>
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              إلغاء
            </button>
            <button type="submit" class="btn btn-success" style="background-color: #047857 !important">
              حفظ التعديلات
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
}
